<!DOCTYPE html>
<html>
<head>
    <title>Drag and drop the shapes</title>

    <script type="text/javascript" src="createjs-2013.12.12.min.js"></script>
    <script type="text/javascript" src="MontessoriTools.js"></script>
    <script>

        var stageWidth = 640; // standard width
        var stageHeight = 480;  // standard height
        var stage; // stage that holds all graphics
        var circles = []; // array of circular buttons
        var num = 8; // number of buttons in array
        var circleHeight = 30;
        var buttonHeight = 40;
        var buttonWidth = 150;
        var statusMsg;
        var colors = [ "red", "orange", "yellow", "green", "blue", "violet", "purple", "pink"];

        // Create a button with a shape inside
        function Button() {
            this.shape = new createjs.Shape();
        }

        // Move the button around when the mouse is clicked and held
        function pressMoveHandler(evt){
            evt.target.x = evt.stageX;
            evt.target.y = evt.stageY;
        }

        // Play a sound when the button is clicked
        function clickHandler(event, sound) {
            createjs.Sound.play(sound);
        }

        // Move the buttons into a row after the mouse is released
        function pressUpHandler() {
            circles.sort(function(a, b) { return a.shape.x - b.shape.x});
            positionCircles(circles);
        }

        // Performs the actual move animation for the buttons
        function positionCircles(myArray) {
            var length = myArray.length;

            for(var i = 0; i < length; i++) {
                var posX = (i + 1) * (circleHeight * 2.5) - circleHeight;
                var posY = circleHeight * 3;
                createjs.Tween.get(myArray[i].shape).to({x:posX},250).to({y:posY}, 250);
            }
            if(checkSuccess(myArray))
                console.log("Success!")
        }

        // Check if the game is successful
        function checkSuccess(myArray) {
            var length = myArray.length;
            var count = myArray.length - 1;

            for(var i = 0; i < length; i++) {
                if(myArray[i].number != count)
                    return false;
                else count--;
            }
            return true;
        }

        // Click to check current status of the game
        function submitClickHandler() {
            if(checkSuccess(circles))
                statusMsg.text = "Correct!";
            else
                statusMsg.text = "Try again";
            statusMsg.x = centerText(statusMsg);
            stage.update();
        }

        // Click to start a new game
        function newGameClickHandler() {
            orderCircles();
            stage.update();
        }

        // Configure the circles
        function orderCircles() {
            var ordering = [];
            for(var i=0; i<num; i++) {
                ordering[i] = i;
            }
            Shuffle(ordering);
            for(var i=0; i<num; i++) {
                circles[i].sound = "note"+(ordering[i]+1);
                circles[i].shape.graphics.beginFill(colors[i]).drawCircle(0, 0, circleHeight);
                circles[i].shape.removeAllEventListeners();
                circles[i].shape.on("click", clickHandler, null, false, circles[i].sound);
                circles[i].shape.on("pressmove", pressMoveHandler);
                circles[i].shape.on("pressup", pressUpHandler);
                circles[i].shape.x = (i + 1) * (circleHeight * 2.5) - circleHeight;
                circles[i].shape.y = circleHeight * 3;
                circles[i].number = ordering[i];
                stage.addChild(circles[i].shape);
            }
        }

        function init() {
            // set up the stage
            stage = new createjs.Stage("canvas");
            stage.enableMouseOver();
            createjs.Ticker.addEventListener("tick", stage);

            loadSounds();

            // Add instructions for the game to the top of the screen
            var instructions = new createjs.Text("Order from high to low:", "bold 25px Arial", "#0066CC");
            instructions.x = centerText(instructions);
            instructions.y = 20;
            stage.addChild(instructions);

            // create a button for each sound and draw it on the screen
            for(i=0; i < num; i++) {
                circles[i] = new Button();
            }

            // configure the buttons with sounds and colors
            orderCircles();

            // Create submit button
            var submitButton = createButton("Submit", "#0066CC", buttonWidth, buttonHeight);
            submitButton.x = stage.canvas.width / 2 - buttonWidth - 30;
            submitButton.y = circleHeight * 3 + buttonHeight * 1.5;
            submitButton.on("click", submitClickHandler);
            stage.addChild(submitButton);

            // Create 'New Game' button
            var newgameButton = createButton("New Game", "#CC3300", buttonWidth, buttonHeight);
            newgameButton.x = stage.canvas.width / 2 + 30;
            newgameButton.y = circleHeight * 3 + buttonHeight * 1.5;
            newgameButton.on("click", newGameClickHandler);
            stage.addChild(newgameButton);

            //Create status message
            statusMsg = new createjs.Text("Status", "bold 25px Arial", "#003300");
            statusMsg.x = centerText(statusMsg);
            statusMsg.y = circleHeight * 5 + buttonHeight * 1.5;
            statusMsg.text = "";
            stage.addChild(statusMsg);

            stage.update();
        }
    </script>
</head>

<body onload="init()">
<canvas id="canvas" width="640" height="480"></canvas>
</body>
</html>