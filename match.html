<!DOCTYPE html>
<html>
<head>
    <title>Match Sounds</title>
    <script type="text/javascript" src="createjs-2013.12.12.min.js"></script>
    <script type="text/javascript" src="MontessoriTools.js"></script>

    <script>
        var stage;
        var rCircle = [];
        var lCircle = [];
        var num = 5;
        var match = 0;
        var circleHeight = 30;
        var buttonHeight = 40;
        var buttonWidth = 150;
        var statusMatch;
        var stageWidth = 480;
        var stageHeight = 640;

        function Button(color, sound) {
            this.shape = new createjs.Shape();
            this.color = color;
            this.sound = "note"+(sound+1);
            this.shape.name = this.color+this.sound;
        }

        var lastSound = {
            color: "start",
            sound: 0
        };

        function drawCircle(circle, index) {
            circle.shape.graphics.beginFill(circle.color).drawCircle(0, 0, circleHeight);

            // red circles go into the first column
            if(circle.color == "red") {
                circle.shape.x = stage.canvas.width/2 - circleHeight * 2;
            }

            // blue circles go into the second column
            else {
                circle.shape.x = stage.canvas.width/2 + circleHeight * 2;
            }

            circle.shape.y = (index + 1) * (circleHeight * 2.5) + circleHeight;
            circle.shape.on("click", handleClick, null, false, [circle.color, circle.sound] );
            circle.shape.on("mouseover", handleMouseOver);

            stage.addChild(circle.shape);
        }

        function handleClick(event, data) {
            var color = data[0];
            var sound = data[1];

            createjs.Sound.play(sound);

            if(color != lastSound["color"]) {
                if(sound === lastSound["sound"]) {
                    var red = stage.getChildByName("red"+sound);
                    var blue = stage.getChildByName("blue"+sound);
                    red.graphics.beginFill("green").drawCircle(0, 0, circleHeight);
                    blue.graphics.beginFill("green").drawCircle(0, 0, circleHeight);
                    red.removeAllEventListeners();
                    blue.removeAllEventListeners();
                    match++;
                }
            }

            lastSound["color"] = color;
            lastSound["sound"] = sound;

            if(match == num) {
                statusMatch.text = "Correct!";
            }
            stage.update();
        }

        function handleMouseOver(event) {
            event.target.alpha *= .80
        }

        // generate two arrays of random numbers of size num
        function randomizeArrays() {
            var redArray = [];
            var blueArray = [];
            for(var i=0; i<num; i++) {
                redArray[i] = i;
                blueArray[i] = i;
            }

            // Randomize the sounds
            Shuffle(redArray);
            Shuffle(blueArray);
            return [redArray, blueArray];
        }

        // Click to start a new game
        function newGameClickHandler() {
            var buttonArray = randomizeArrays();
            var redArray = buttonArray[0];
            var blueArray = buttonArray[1];

            for(var i=0; i<num; i++) {
                var sound = "note"+(redArray[i]+1);
                rCircle[i].shape.removeAllEventListeners();
                rCircle[i].sound = "note"+sound;
                rCircle[i].shape.name = "red"+sound;
                rCircle[i].shape.graphics.beginFill("red").drawCircle(0, 0, circleHeight);
                rCircle[i].shape.on("click", handleClick, null, false, ["red", sound] );

                sound = "note"+(blueArray[i]+1);
                lCircle[i].shape.removeAllEventListeners();
                lCircle[i].sound = "note"+sound;
                lCircle[i].shape.name = "blue"+sound;
                lCircle[i].shape.graphics.beginFill("blue").drawCircle(0, 0, circleHeight);
                lCircle[i].shape.on("click", handleClick, null, false, ["blue", sound] );
            }
            stage.update();
        }

        function init() {
            stage = new createjs.Stage("canvas");
            stage.enableMouseOver(20);
            loadSounds();
            CreateBorder();

            // Add instructions for the game to the top of the screen
            var instructions = new createjs.Text("Match the sounds on left and right:", "bold 25px Arial", "#0066CC");
            instructions.x = centerText(instructions);
            instructions.y = 20;
            stage.addChild(instructions);

            // initialize the arrays
            var buttonArray = randomizeArrays();
            var redArray = buttonArray[0];
            var blueArray = buttonArray[1];

            // Create and draw the buttons
            for(var i=0; i < num; i++) {
                rCircle[i] = new Button("red", redArray[i]);
                lCircle[i] = new Button("blue", blueArray[i]);
                drawCircle(lCircle[i], i);
                drawCircle(rCircle[i], i);
            }

            // Create 'New Game' button
            var newgameButton = CreateButton("New Game", "#0066CC", buttonWidth, buttonHeight);
            newgameButton.x = stage.canvas.width / 2 - buttonWidth/2;
            newgameButton.y = circleHeight * 14 + buttonHeight;
            newgameButton.on("click", newGameClickHandler);
            stage.addChild(newgameButton);

            //Create status message
            statusMatch = new createjs.Text("Correct!", "bold 25px Arial", "#003300");
            statusMatch.x = centerText(statusMatch);
            statusMatch.y = circleHeight * 17 + buttonHeight;
            statusMatch.text = "";
            stage.addChild(statusMatch);
            stage.update();
        }
    </script>
</head>
<body onLoad="init();">
<canvas id="canvas" width="480" height="640">
    alternate content
</canvas>
</body>
</html>